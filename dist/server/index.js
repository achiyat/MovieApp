import p from"express";import l from"cors";import i from"axios";import"dotenv/config";import y from"path";import{fileURLToPath as v}from"node:url";var t=p();t.use(l());t.use(p.json());var g=process.env.PORT||8e3,a=process.env.TMDB_API_KEY,n="https://api.themoviedb.org/3",d=v(new URL("../client",import.meta.url));t.use(p.static(d));var c=(s,e,r)=>{if(!a)return console.log("Error: API key is missing or undefined"),e.status(460).json({error:"API key is missing or undefined"});r()};t.get("/similar-movie/:id",c,async(s,e)=>{let{id:r}=s.params;try{let o=await i.get(`${n}/movie/${r}/similar`,{params:{api_key:a}});e.json(o.data)}catch(o){console.error(`Error fetching similar movies for id ${r}:`,o),e.status(500).json({error:"Failed to fetch similar movies"})}});t.get("/movies-by-genres",c,async(s,e)=>{let{genre:r}=s.query;try{let o=await i.get(`${n}/discover/movie`,{params:{api_key:a,with_genres:r,sort_by:"popularity.desc"}});e.json(o.data)}catch(o){a?(console.error(`Error fetching movies by genre ${r}:`,o),e.status(500).json({error:"Failed to fetch movies by genre"})):e.status(400).json({error:"API key is missing or undefined"})}});t.get("/now-playing",c,async(s,e)=>{try{let r=await i.get(`${n}/movie/now_playing`,{params:{api_key:a,language:"en-US",sort_by:"popularity.desc",page:1,pageSize:20}});e.json(r.data)}catch(r){a?(console.error("Error fetching now playing movies:",r),e.status(500).json({error:"Failed to fetch now playing movies"})):e.status(400).json({error:"API key is missing or undefined"})}});t.get("/by-movie-details/:id",c,async(s,e)=>{let r=s.params.id;try{let o=await i.get(`${n}/movie/${r}`,{params:{api_key:a,language:"en-US",append_to_response:"videos,images,credits",include_image_language:"en,null"}});e.json(o.data)}catch(o){console.error("Error fetching details movie:",o),e.status(500).json({error:"Failed to fetch details movie"})}});t.get("/movie-reviews/:id",c,async(s,e)=>{let r=s.params.id;try{let o=await i.get(`${n}/movie/${r}/reviews`,{params:{api_key:a}});e.json(o.data)}catch(o){console.error("Error fetching reviews movie:",o),e.status(500).json({error:"Failed to fetch reviews movie"})}});t.get("/movie-recommendations/:id",c,async(s,e)=>{let r=s.params.id;try{let o=await i.get(`${n}/movie/${r}/recommendations`,{params:{api_key:a}});e.json(o.data)}catch(o){console.error(`Error fetching recommendations for movie ID ${r}:`,o),e.status(500).json({e:`Failed to fetch recommendations for movie ID ${r}`})}});t.get("/movie-genre-page/:id/:page",c,async(s,e)=>{let r=s.params.id,o=s.params.page;try{let m=await i.get(`${n}/discover/movie`,{params:{api_key:a,with_genres:r,language:"en-US",sort_by:"popularity.desc",include_adult:!1,page:o}});e.json(m.data)}catch(m){console.error("Error fetching movies from TMDB:",m),e.status(500).json({e:"Failed to fetch movies"})}});t.get("/search-movies",c,async(s,e)=>{let{query:r}=s.query;try{let o=await i.get(`${n}/search/movie`,{params:{api_key:a,query:r,language:"en-US",page:1,pageSize:10}});e.json(o.data)}catch(o){console.error("Error searching for movies:",o),e.status(500).json({error:"Failed to search movies"})}});t.get("*",function(s,e){e.sendFile(y.join(d,"index.html"))});t.listen(g,()=>{console.log(`Server is running on http://localhost:${g}`)});
